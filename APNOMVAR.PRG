* DEBE RECIBIR PARA SU FUNCIONAMIENTO:
* STORE "AP???GEN.DBF" TO QGENFIL  . \
* STORE "AP???GE2.IDX" TO QGENIDX  .  \PROCEDENCIA DE LA INFORMACION
* STORE "AP???CON.DBF" TO QCONFIL  .  /
* STORE "AP???CO1.IDX" TO QCONIDX  . /
* STORE WGRUPO         TO QGRUPO
* STORE WNOMINA        TO QNOMINA
* STORE WF1            TO QDESDE
* STORE WF2            TO QHASTA
SELECT 1
USE &QGENFIL INDEX &QGENIDX
SELECT 2
USE &QCONFIL INDEX &QCONIDX
SELECT 3
USE APCON INDEX APCON
SELECT 4
USE APPERSON INDEX APPERSO1
SELECT 5
USE APNOMINA INDEX APNOMINA
SELECT 6
USE APUBICA  INDEX APUBICA
SELECT 7
USE APCARGOS INDEX APCARGOS
SELECT 8
USE APCONPER INDEX APCONPER
SET DEVI TO PRINT
STORE "**"  TO WRUPGRUPO
STORE "**"  TO WRUPNOMINA
STORE "**"  TO WRUPDIRE
STORE "**"  TO WRUPDEPA
STORE "***" TO WRUPSECC
STORE 100 TO WLINE
STORE 0   TO WPAGINA
SELECT 5
FIND &QGRUPO
DO WHILE .NOT. EOF() .AND. GRUPO = QGRUPO
   IF QNOMINA <> SPACE(2) .AND. NOMINA <> QNOMINA
      SELECT 5
      SKIP
      LOOP
   ENDIF
   STORE NOMINA TO QQNOMINA
   STORE DESCRI TO WNOMIDES
   SELECT 1
   STORE QGRUPO+QQNOMINA+STR(YEAR(QDESDE))+STR(MONTH(QDESDE))+STR(DAY(QDESDE)) TO WCLAVE1
   FIND &WCLAVE1
   IF EOF()
      STORE "ERROR, NO HAY INFORMACION PARA NOMINA:"+QQNOMINA+" EN ESTA FECHA DE CIERRE" TO MES
      DO AVISO WITH MES
      STORE "RECOMENDAMOS SOLICITAR NOMINA POR NOMINA, OPRIMA <ENTER>." TO MES
      DO AVISO WITH MES
      EXIT
   ENDIF
   DO WHILE .NOT. EOF() .AND. GRUPO = QGRUPO .AND. NOMINA = QQNOMINA  FECHA2 >=QDESDE .AND. FECHA2 <=QHASTA
      STORE .T.     TO  XFLAGNAME
      STORE CEDULA  TO  XCEDULA
      STORE FECHA1  TO  XFECHA1
      STORE FECHA2  TO  XFECHA2
      STORE GRUPO   TO  XGRUPO
      STORE NOMINA  TO  XNOMINA
      STORE DIRE    TO  XDIRE
      STORE DEPA    TO  XDEPA
      STORE SECC    TO  XSECC
      STORE CARGO   TO  XCARGO
      STORE SUELDOH TO  XSUELDOH
      STORE SUELDOD TO  XSUELDOD
      STORE SUELDOP TO  XSUELDOP
      STORE TIPO    TO  XTIPO
      STORE FECHA2  TO  XFECHA
      STORE 0       TO WTOTASI
      STORE 0       TO WTOTBON
      STORE 0       TO WTOTNBON
      STORE 0       TO WTOTDEC
      STORE 0       TO WTOTLIQ
      SELECT 4
      FIND &XCEDULA
      IF EOF()
         STORE "NO REGISTRADO" TO XAPELLIDOS
         STORE " "             TO XNOMBRES
         STORE "0"             TO XCARGO
         STORE 0               TO XSUELDO
      ELSE
         STORE APELLIDOS       TO XAPELLIDOS
         STORE NOMBRES         TO XNOMBRES
         STORE CARGO           TO XCARGO
         IF TIPO = "E".or.tipo="J".or.tipo="P"
            STORE SUELDOP       TO XSUELDO
         ELSE
            STORE SUELDOD       TO XSUELDO
         ENDIF
      ENDIF
      IF XCARGO <> SPACE(4)
         SELECT 7
         FIND &XCARGO
         IF EOF()
            STORE "NO REGISTRADO" TO XCARGODES
         ELSE
            STORE DESCRI          TO XCARGODES
         ENDIF
      ELSE
         STORE    "NO DEFINIDO"   TO XCARGODES
      ENDIF
      STORE XCEDULA+STR(YEAR(XFECHA))+STR(MONTH(XFECHA))+STR(DAY(XFECHA)) TO WCLAVE2
      SELECT 2
      FIND &WCLAVE2
      DO WHILE .NOT. EOF() .AND. CEDULA=XCEDULA .AND. FECHA2=XFECHA
         STORE CONCEPTO TO XCONCEPTO
         STORE CANTIDAD TO XCANTIDAD
         STORE MONTO    TO XMONTO
         STORE SALDO    TO XSALDO
         STORE ORIGEN   TO XORIGEN
         SELECT 3
         FIND &XCONCEPTO
         IF EOF()
            STORE "NO REGISTRADO" TO XCONCEDES
            STORE "****"          TO XCONCEUND
            STORE .F.             TO XFLAGCON
         ELSE
            STORE DESCRI          TO XCONCEDES
            STORE UNIDAD          TO XCONCEUND
            STORE .T.             TO XFLAGCON
         ENDIF
         **** BUSCA LOS VALORES ESTANDARD DE ESTA PERSONA PARA ESTE CONCEPTO
         STORE XCEDULA+XCONCEPTO TO XCLAVENOR
         SELECT 8
         FIND &XCLAVENOR
         IF EOF()
            STORE 0        TO WCANTNOR
            STORE 0        TO WMONTNOR
         ELSE
            STORE CANTIDAD TO WCANTNOR
            STORE MONTO    TO WMONTNOR
         ENDIF
         ****     
         IF XMONTO - WMONTNOR <> 0
            IF XFLAGNAME
               DO RUNOMVAR
               STORE WLINE + 1 TO WLINE
               IF WLINE > 55
                  DO HDNOMVAR
               ENDIF
               @ WLINE,0 SAY XCEDULA
               @ WLINE,13 SAY RTRIM(XAPELLIDOS)+", "+RTRIM(XNOMBRES)
               STORE WLINE + 1 TO WLINE
               @ WLINE,0  SAY STR(XSUELDO,10,2)
               @ WLINE,13 SAY XCARGODES
               STORE .F. TO XFLAGNAME
            ENDIF
            SELECT 2
            STORE WLINE + 1 TO WLINE
            IF WLINE > 55
               DO HDNOMVAR
            ENDIF
            @ WLINE,45  SAY XCONCEPTO
            @ WLINE,52  SAY XCONCEDES
            @ WLINE,78  SAY XCANTIDAD-WCANTNOR PICTURE "####.##"
            IF XFLAGCON
               IF APCON->GRUPO = 1
                  @ WLINE,86  SAY XMONTO-WMONTNOR  PICTURE "#######.##"
               ELSE
                  IF APCON->GRUPO = 2
                     @ WLINE,98 SAY XMONTO-WMONTNOR PICTURE "#######.##"
                  ENDIF
               ENDIF
               IF XSALDO > 0
                  @ WLINE,110 SAY XSALDO PICTURE "#######.##"
               ENDIF
            ENDIF
         ENDIF
         SELECT 2
         SKIP
      ENDDO
      SELECT 1
      SKIP
   ENDDO
   SELECT 5
   SKIP
ENDDO
@ PROW(), PCOL() SAY CHR(18)
SET DEVI TO SCRE
CLOSE DATA
CLOSE INDEX
RETURN

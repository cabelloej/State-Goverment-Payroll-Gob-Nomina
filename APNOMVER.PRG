* DEBE RECIBIR PARA SU FUNCIONAMIENTO:
* STORE "AP???GEN.DBF" TO QGENFIL  . \
* STORE "AP???GE2.IDX" TO QGENIDX  .  \PROCEDENCIA DE LA INFORMACION
* STORE "AP???CON.DBF" TO QCONFIL  .  /
* STORE "AP???CO1.IDX" TO QCONIDX  . /
* STORE WGRUPO         TO QGRUPO
* STORE WNOMINA        TO QNOMINA
* STORE WF1            TO QDESDE
* STORE WF2            TO QHASTA

SELECT 1
USE &QGENFIL INDEX &QGENIDX
SELECT 2
USE &QCONFIL INDEX &QCONIDX
SELECT 3
USE APCON INDEX APCON
SELECT 4
USE APPERSON INDEX APPERSO1
SELECT 5
USE APNOMINA INDEX APNOMINA
SELECT 6
USE APCARGOS INDEX APCARGOS
SELECT 7
USE APBANCOS INDEX APBANCOS
SET DEVI TO PRINT
@ PROW(), PCOL() SAY CHR(18)
@ PROW(), PCOL() SAY CHR(27)+CHR(67)+CHR(33)
EJECT
SELECT 5
FIND &QGRUPO
DO WHILE .NOT. EOF() .AND. GRUPO = QGRUPO
   IF QNOMINA <> SPACE(2) .AND. NOMINA <> QNOMINA
      SELECT 5
      SKIP
      LOOP
   ENDIF
   STORE NOMINA TO QQNOMINA
   STORE DESCRI TO WNOMIDES
   SELECT 1
   STORE QGRUPO+QQNOMINA+STR(YEAR(QDESDE))+STR(MONTH(QDESDE))+STR(DAY(QDESDE)) TO WCLAVE1
   FIND &WCLAVE1
   IF EOF()
      STORE "ERROR, NO HAY INFORMACION PARA NOMINA:"+QQNOMINA+" EN ESTA FECHA DE CIERRE" TO MES
      DO AVISO WITH MES
      STORE "RECOMENDAMOS SOLICITAR NOMINA POR NOMINA, OPRIMA <ENTER>." TO MES
      DO AVISO WITH MES
      EXIT
   ENDIF
   DO WHILE .NOT. EOF() .AND. GRUPO = QGRUPO .AND. NOMINA = QQNOMINA  FECHA2 >=QDESDE .AND. FECHA2 <=QHASTA
      *** FILTRO PARA IMPRIMIR SOBRE INDIVIDUAL
      IF WZCEDULA <> SPACE(12) .AND. WZCEDULA <> CEDULA
         SELECT 1
         SKIP
         LOOP
      ENDIF
      *** FIN FILTRO
      STORE CEDULA  TO  XCEDULA
      STORE FECHA1  TO  XFECHA1
      STORE FECHA2  TO  XFECHA2
      STORE GRUPO   TO  XGRUPO
      STORE NOMINA  TO  XNOMINA
      STORE DIRE    TO  XDIRE
      STORE DEPA    TO  XDEPA
      STORE SECC    TO  XSECC
      STORE CARGO   TO  XCARGO
      STORE SUELDOH TO  XSUELDOH
      STORE SUELDOD TO  XSUELDOD
      STORE SUELDOP TO  XSUELDOP
      STORE TIPO    TO  XTIPO
      STORE FECHA2  TO  XFECHA
      STORE 100     TO  WLINE
      STORE 0       TO  WTOTASI
      STORE 0       TO  WTOTBON
      STORE 0       TO  WTOTNBON
      STORE 0       TO  WTOTDEC
      STORE 0       TO  WTOTLIQ
      

      STORE XCEDULA+STR(YEAR(XFECHA))+STR(MONTH(XFECHA))+STR(DAY(XFECHA)) TO WCLAVE2
      SELECT 2
      FIND &WCLAVE2
      DO WHILE .NOT. EOF() .AND. CEDULA=XCEDULA .AND. FECHA2=XFECHA
         STORE CONCEPTO TO XCONCEPTO
         STORE CANTIDAD TO XCANTIDAD
         STORE MONTO    TO XMONTO
         STORE SALDO    TO XSALDO
         STORE ORIGEN   TO XORIGEN
         SELECT 3
         FIND &XCONCEPTO
         IF EOF()
            STORE "NO REGISTRADO" TO XCONCEDES
            STORE "****"          TO XCONCEUND
            STORE .F.             TO XFLAGCON
         ELSE
            STORE DESCRI          TO XCONCEDES
            STORE UNIDAD          TO XCONCEUND
            STORE .T.             TO XFLAGCON
         ENDIF
         SELECT 4
         FIND &XCEDULA
         IF EOF()
            STORE "NO REGISTRADO" TO XAPELLIDOS
            STORE " "             TO XNOMBRES
           *STORE " "             TO XFICHA
            STORE " "             TO XCENTRO
         ELSE
            STORE APELLIDOS       TO XAPELLIDOS
            STORE NOMBRES         TO XNOMBRES
           *STORE FICHA           TO XFICHA
            STORE BANCO           TO XCENTRO
         ENDIF
         IF XCARGO <> SPACE(6)
            SELECT 6
            FIND &XCARGO
            IF EOF()
               STORE "NO REGISTRADO" TO XCARGODES
            ELSE
               STORE DESCRI          TO XCARGODES
            ENDIF
         ELSE
            STORE "           " TO XCARGODES
         ENDIF
         IF XCENTRO <> SPACE(2)
            SELECT 7
            FIND &XCENTRO
            IF EOF()
               STORE "NO REGISTRADO" TO XCENTRODES
            ELSE
               STORE DESCRI          TO XCENTRODES
            ENDIF
         ELSE
            STORE    "NO DEFINIDO"   TO XCENTRODES
         ENDIF

         SELECT 2
         STORE WLINE + 1 TO WLINE
         IF WLINE > 26
            DO HDNOMVER
         ENDIF
         @ WLINE,00  SAY XCONCEPTO
         @ WLINE,05  SAY XCONCEDES
         @ WLINE,31  SAY XCONCEUND
         @ WLINE,37  SAY XCANTIDAD  PICTURE "###.##"
         IF XFLAGCON
            IF APCON->GRUPO = 1
               @ WLINE,44  SAY XMONTO  PICTURE "#######.##"
            ELSE
               IF APCON->GRUPO = 2
                  @ WLINE,54 SAY XMONTO PICTURE "#######.##"
               ENDIF
            ENDIF
            IF XSALDO > 0
               @ WLINE,69 SAY XSALDO PICTURE "#######.##"
            ENDIF
            DO TOTALIZA
         ENDIF
         SELECT 2
         SKIP
      ENDDO
      IF WTOTASI>0 .OR. WTOTDEC > 0
         STORE WLINE+1 TO WLINE
         @ 28,00  SAY "Firma del trabajador:"
         @ 28,44  SAY WTOTASI  PICTURE "########.##"
         @ 28,54  SAY WTOTDEC  PICTURE "########.##"
         @ 28,69  SAY WTOTLIQ  PICTURE "########.##"
        *@ 28,90  SAY "TOTAL RECIBIDO Bs: "+LTRIM(STR(WTOTLIQ,12,2))
      ENDIF
      IF WTOTLIQ < 0
         SET DEVI TO SCRE
         STORE "ERROR, SOBRE DE CEDULA:"+XCEDULA+" CON SALDO NEGATIVO" TO MES
         DO AVISO WITH MES
         SET DEVI TO PRINT      
      ENDIF
      SELECT 1
      SKIP
   ENDDO
   SELECT 5
   DO RECLOC
   if sw=0
      REPLACE ESTADO WITH 5
   endif
   UNLOCK
   SKIP
ENDDO
@ PROW(), PCOL() SAY CHR(27)+CHR(67)+CHR(66)
@ PROW(), PCOL() SAY CHR(18)
EJECT
SET DEVI TO SCRE
CLOSE DATA
CLOSE INDEX

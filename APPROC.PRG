PROCEDURE INDICES
DEFI WIND WININD FROM 05,50 TO 07,72 ;
                 TITLE " REORGANIZAR " ;
                 DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WININD
@ 0,0 CLEAR
store 2 to wop
do while .t.
   store space(10) to wclaveind
   @ 00,00  say "Clave:" get wclaveind
   read
   if UPPER(wclaveind)<>"EJCM      "
      exit
   endif
   @ 00,00  get wop pict "@*H Aceptar ;Cancelar" defa wop
   read
   if lastkey()=13
      exit
   endif
enddo
if wop=1
   @ 00,00 
   @ 00,00 SAY "Favor esperar..."
else
   RELE WIND WININD
   RETURN
endif
CLOSE DATA
CLOSE INDEX
***
USE APGRUPOS
DO FILLOC
INDEX ON GRUPO TO APGRUPOS
UNLOCK ALL
***
USE APNOMINA
DO FILLOC
INDEX ON GRUPO+NOMINA TO APNOMINA
UNLOCK ALL
***
USE APUBICA
DO FILLOC
INDEX ON DIRE+DEPA+SECC TO APUBICA
UNLOCK ALL
***
USE APCON
DO FILLOC
INDEX ON CODIGO TO APCON
UNLOCK ALL
***
USE APCARGOS
DO FILLOC
INDEX ON CARGO TO APCARGOS
UNLOCK ALL
***
USE APPERSON
DO FILLOC
INDEX ON CEDULA                             TO APPERSO1
INDEX ON GRUPO+NOMINA+DIRE+DEPA+SECC+CEDULA TO APPERSO2
INDEX ON DIRE+DEPA+SECC+CEDULA              TO APPERSO3
INDEX ON APELLIDOS+NOMBRES                  TO APPERSO4
UNLOCK ALL
***
USE APCONPER
DO FILLOC
INDEX ON CEDULA+CONCEPTO TO APCONPER
UNLOCK ALL
***
USE APPAGGEN
DO FILLOC
* PARA HISTORICO PERSONAL
INDEX ON CEDULA+STR(YEAR(FECHA2))+STR(MONTH(FECHA2))+STR(DAY(FECHA2)) TO APPAGGE1
* PARA HISTORICO NOMINAL (APNOMCON, AP0205, ETC)
INDEX ON GRUPO+NOMINA+STR(YEAR(FECHA2))+STR(MONTH(FECHA2))+STR(DAY(FECHA2))+DIRE+DEPA+SECC+CEDULA TO APPAGGE2
* PARA HISTORICO NOMINAL HORIZONTAL (SABANA)
INDEX ON GRUPO+NOMINA+STR(YEAR(FECHA2))+STR(MONTH(FECHA2))+STR(DAY(FECHA2))+CARGO+CEDULA          TO APPAGGE3
UNLOCK ALL
***
USE APPAGCON
DO FILLOC
INDEX ON CEDULA+STR(YEAR(FECHA2))+STR(MONTH(FECHA2))+STR(DAY(FECHA2))+CONCEPTO TO APPAGCO1
INDEX ON CONCEPTO+STR(YEAR(FECHA2))+STR(MONTH(FECHA2))+STR(DAY(FECHA2))+CEDULA TO APPAGCO2
UNLOCK ALL
***
USE APHISGEN
DO FILLOC
* PARA HISTORICO PERSONAL
INDEX ON CEDULA+STR(YEAR(FECHA2))+STR(MONTH(FECHA2))+STR(DAY(FECHA2)) TO APHISGE1
* PARA HISTORICO NOMINAL (APNOMCON, AP0205, ETC)
INDEX ON GRUPO+NOMINA+STR(YEAR(FECHA2))+STR(MONTH(FECHA2))+STR(DAY(FECHA2))+DIRE+DEPA+SECC+CEDULA TO APHISGE2
* PARA HISTORICO NOMINAL HORIZONTAL (SABANA)
INDEX ON GRUPO+NOMINA+STR(YEAR(FECHA2))+STR(MONTH(FECHA2))+STR(DAY(FECHA2))+CARGO+CEDULA          TO APHISGE3
UNLOCK ALL
***
USE APHISCON
DO FILLOC
INDEX ON CEDULA+STR(YEAR(FECHA2))+STR(MONTH(FECHA2))+STR(DAY(FECHA2))+CONCEPTO TO APHISCO1
INDEX ON CONCEPTO+STR(YEAR(FECHA2))+STR(MONTH(FECHA2))+STR(DAY(FECHA2))+CEDULA TO APHISCO2
UNLOCK ALL
***
USE APCENTRO
DO FILLOC
INDEX ON CODIGO TO APCENTRO
UNLOCK ALL
***
USE APCONTRA
DO FILLOC
INDEX ON CODIGO TO APCONTRA
UNLOCK ALL
***
USE APSINDIC
DO FILLOC
INDEX ON CODIGO TO APSINDIC
UNLOCK ALL
***
USE APBANCOS
DO FILLOC
INDEX ON CODIGO TO APBANCOS
UNLOCK ALL

RELE WIND WININD
STORE "EL SISTEMA SE REINICIALIZARA, OPRIMA <ENTER> PARA CONTINUAR." TO MES
DO AVISO WITH MES
CLOSE DATA
CLOSE INDEX
QUIT
*****************
PROCEDURE COMPACTA
DEFI WIND WINCOM FROM 05,50 TO 07,72 ;
                 TITLE " COMPACTAR " ;
                 DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WINCOM
@ 0,0 CLEAR
store 2 to wop
do while .t.
   store space(10) to wclaveind
   @ 00,00  say "Clave:" get wclaveind
   read
   if UPPER(wclaveind)<>"EJCM      "
      exit
   endif
   @ 00,00  get wop pict "@*H Aceptar ;Cancelar" defa wop
   read
   if lastkey()=13
      exit
   endif
enddo
if wop=1
   @ 00,00 
   @ 00,00 SAY "Favor esperar..."
else
   RELE WIND WINCOM
   RETURN
endif
***
USE APGRUPOS EXCL
DO FILLOC
PACK
UNLOCK ALL
***
USE APNOMINA EXCL
DO FILLOC
PACK
UNLOCK ALL
***
USE APUBICA EXCL
DO FILLOC
PACK
UNLOCK ALL
***
USE APCON EXCL
DO FILLOC
PACK
UNLOCK ALL
***
USE APCARGOS EXCL
DO FILLOC
PACK
UNLOCK ALL
***
USE APPERSON EXCL
DO FILLOC
PACK
UNLOCK ALL
***
USE APCONPER EXCL
DO FILLOC
PACK
UNLOCK ALL
***
USE APPAGGEN EXCL
DO FILLOC
PACK
UNLOCK ALL
***
USE APPAGCON EXCL
DO FILLOC
PACK
UNLOCK ALL
***
USE APHISGEN EXCL
DO FILLOC
PACK
UNLOCK ALL
***
USE APHISCON EXCL
DO FILLOC
PACK
UNLOCK ALL
***
USE APCENTRO EXCL
DO FILLOC
PACK
UNLOCK ALL
***
USE APCONTRA EXCL
DO FILLOC
PACK
UNLOCK ALL
***
USE APSINDIC EXCL
DO FILLOC
PACK
UNLOCK ALL
***
USE APBANCOS EXCL
DO FILLOC
PACK
UNLOCK ALL
***
RELE WIND WINCOM
STORE "*** REORGANIZE INDICES *** OPRIMA <ENTER> PARA CONTINUAR." TO WTEXT
DO AVISO WITH WTEXT
CLOSE DATA
CLOSE INDEX
QUIT
************************
PROCEDURE RECLOC
SAVE SCRE TO SCRE1
STORE .T. TO WRECLOC
STORE .T. TO WFLAGMES
DO WHILE WRECLOC
   IF RLOCK()
      EXIT
   ELSE
      IF WFLAGMES
         @ 12,05 CLEAR TO 18,75
         @ 12,05 TO 18,75
         @ 14,15 SAY "REGISTRO OCUPADO POR OTRO USUARIO, REINTENTANDO ..."
         @ 16,15 SAY "          OPRIMA [ESC] PARA ABANDONAR              "
         STORE .F. TO WFLAGMES
      ENDIF
      WVALUE = INKEY()
      IF WVALUE = 27
         store .t. to wjumping
         close data
         close index
         RETURN TO MASTER
      ENDIF
   ENDIF
ENDDO
RESTORE SCRE FROM SCRE1
RETURN
*************************
PROCEDURE FILLOC
SAVE SCRE TO SCRE1
STORE .T. TO WFILLOC
STORE .T. TO WFLAGMES
DO WHILE WFILLOC
   IF FLOCK()
      EXIT
   ELSE
      IF WFLAGMES
         @ 12,05 CLEAR TO 18,75
         @ 12,05 TO 18,75
         @ 14,15 SAY "ARCHIVO OCUPADO POR OTRO USUARIO, REINTENTANDO ..."
         @ 16,15 SAY "          OPRIMA [ESC] PARA ABANDONAR             "
         STORE .F. TO WFLAGMES
      ENDIF
      WVALUE = INKEY()
      IF WVALUE = 27
         store .t. to wjumping
         close data
         close index
         RETURN TO MASTER
      ENDIF
   ENDIF
ENDDO
RESTORE SCRE FROM SCRE1
RETURN
*************************
PROCEDURE PREGUNTA
STORE .T. TO WPREG
DO WHILE WPREG
   @ 23,0
   STORE SUBSTR(WCH,1,1) TO WCHOICE
   @ 23,40- (LEN(TEX)/2) SAY TEX GET WCHOICE
   READ
   STORE UPPER(WCHOICE) TO WCHOICE
   IF AT(WCHOICE,WCH) > 0
      STORE .F. TO WPREG
      EXIT
   ENDIF
ENDDO
@ 23,0
STORE WCHOICE TO WCH
RETURN
*************************
PROCEDURE MENSAJE
PARAMETERS MES
@ 23,1
@ 23,40-(LEN(MES)/2) SAY MES
RETURN
*************************
PROCEDURE AVISO
PARAMETERS MES
STORE " " TO X
?? CHR(7)
@ 23,1 SAY SPACE(78)
@ 23,40-(LEN(MES)/2) SAY MES GET X
READ
@ 22,1
RETURN
*************************
PROCEDURE CHKPRINT
PARAMETERS SALTAR
store .t. to wprinting
do while wprinting
   store "Prepare la impresora y oprima <ENTTER> para continuar o (R)echazar" to Qmes
   @ 23,1
   @ 23,40-(len(Qmes)/2) say Qmes
   store " " to wstat
   @ 23,78 get wstat
   read
   if upper(wstat) = "R"
      store 1 to saltar
      store .f. to wprinting
   else
      store 0 to saltar
      if sys(13) = "READY"
         store .f. to wprinting
      endif
   endif
   @ 23,1
enddo
RETURN
*************************
procedure informa
store " " to qw1
store " " to qw2
store " " to qw3
store " " to qw4
store " " to qw5
store " " to qw6
store " " to qw7
store " " to qw8
store " " to qw9
store " " to qw10
store " " to qw11
store " " to qw12
store " " to qw13
store " " to qw14
store " " to qw15
store " " to qw16
store " " to qw17
store " " to qw18
store " " to qw19
store " " to qw20
store " " to qw21
store " " to qw22
store ")" to qw23
store "O" to qw24
store "M" to qw25
store "E" to qw26
store "D" to qw27
store "(" to qw28
store " " to qw29
store "A" to qw30
store "I" to qw31
store "R" to qw32
store "O" to qw33
store "L" to qw34
store "A" to qw35
store "R" to qw36
store "T" to qw37
store "N" to qw38
store "O" to qw39
store "C" to qw40
STORE QW40+QW39+QW38+QW37+QW36+QW35+QW34+QW33+QW32+QW31+QW30+QW29+QW28 TO QQWW
STORE QQWW+QW27+QW26+QW25+QW24+QW23+QW22+QW21+QW20+QW19+QW18+QW17+QW16 TO QQWW
STORE QQWW+QW15+QW14+QW13+QW12+QW11+QW10+QW9+QW8+QW7+QW6+QW5+QW4+QW3+QW2+QW1 TO QQWW
RETURN
*************************
PROCEDURE ACCESO
PARAMETERS WPROGACC,WFLAGACC
STORE .T. TO WFLAGACC
IF USUARIOS->USERPRO <> SPACE(2)
   IF USUARIOS->USERPRO = "**"
      IF WPROGACC <> "05" .AND. PROGACC <> "12"
         STORE .F. TO WFLAGACC
      ENDIF
   ELSE
      IF USUARIOS->USERPRO <> WPROGACC
         STORE .F. TO WFLAGACC
      ENDIF
   ENDIF
ENDIF
RETURN
*************************
PROCEDURE ESTADO
DO CASE
   CASE WESTADO = 0
        STORE "CERRADA         " TO WESTADODES
   CASE WESTADO = 1
        STORE "CARGANDO VARIAC." TO WESTADODES
   CASE WESTADO = 2
        STORE "NOMINA ORDINAR. " TO WESTADODES
   CASE WESTADO = 3
        STORE "NOMINA PRESUP.  " TO WESTADODES
   CASE WESTADO = 4
        STORE "NOMINA CONCEPT. " TO WESTADODES
   CASE WESTADO = 5
        STORE "NOMINA VERTICAL " TO WESTADODES
   CASE WESTADO = 6
        STORE "NOMINA BANCARIA " TO WESTADODES
   CASE WESTADO = 7
        STORE "NOMINA RESUMEN  " TO WESTADODES
ENDCASE
*******************
PROCEDURE SOBRECAL
SELECT APPAGCON
FIND &XCEDULA
DO WHILE .NOT. EOF() .AND. CEDULA = XCEDULA
   STORE CONCEPTO       TO XCONCEPTO
   STORE CANTIDAD       TO XCANTIDAD
   STORE MONTO/CANTIDAD TO XMONTO
   STORE 0              TO XSALDO
   SELECT APCON
   FIND &XCONCEPTO
   IF EOF()
      SELECT APPAGCON
      SKIP
      LOOP
   ELSE
      STORE FORMA      TO XFORMA
      STORE FACTOR     TO XFACTOR
      STORE MINIMO     TO XMINIMO
      STORE MAXIMO     TO XMAXIMO
      STORE 0          TO XMONTOINI
      STORE 0          TO XMONTOPRO
      STORE SALDO      TO XSALDOTIPO
   ENDIF
   SELECT APCONPER
   STORE XCEDULA+XCONCEPTO TO XCLAVE
   FIND &XCLAVE
   IF EOF()
      * TOMA LOS VALORES POR DEFECTO DE APCON
   ELSE
      STORE FACTOR   TO XFACTOR
      STORE MINIMO   TO XMINIMO
      STORE MAXIMO   TO XMAXIMO
      STORE MONTOINI TO XMONTOINI
      STORE MONTOPRO TO XMONTOPRO
   ENDIF
   DO FORMAS
   SELECT APPAGCON
   DO RECLOC
   IF XMONTO <=0
      DELETE
   ELSE
      REPLACE MONTO WITH XMONTO
      REPLACE SALDO WITH XSALDO
   ENDIF
   UNLOCK
   SKIP
ENDDO
RETURN
*************************
PROCEDURE FORMAS
IF XFORMA = 1
   *** SI SE INGRESA UN MONTO POR VARIACION DEBE SER RESPETADO
   IF XFORMA=1.AND.XMONTO>0
      STORE XMONTO            TO XFACTOR
   ENDIF
   ***
   STORE XCANTIDAD*XFACTOR TO XMONTO
ELSE
   IF XFORMA = 2
      STORE XCANTIDAD*(APPERSON->SUELDOH*(XFACTOR/100)) TO XMONTO
   ELSE
      IF XFORMA = 3
         STORE XCANTIDAD*(APPERSON->SUELDOD*(XFACTOR/100)) TO XMONTO
      ELSE
         IF XFORMA = 4
            STORE XCANTIDAD*(APPERSON->SUELDOP*(XFACTOR/100)) TO XMONTO
         ELSE
            IF XFORMA = 5
               STORE XCANTIDAD*(WTOTBON*(XFACTOR/100)) TO XMONTO
            ELSE
               IF XFORMA = 6
                  STORE XCANTIDAD*(WTOTASI*(XFACTOR/100)) TO XMONTO
               ELSE
                  IF XFORMA = 7
                     STORE "APPR"+LTRIM(RTRIM(XCONCEPTO))+".FXP" TO WWFILE
                     DO &WWFILE
                  ELSE
                     STORE "FORMA DE CALCULO INDEFINIDO EN CONCEPTO:"+RTRIM(LTRIM(XCONCEPTO))+" DE CEDULA:"+XCEDULA TO MES
                     DO AVISO WITH MES
                  ENDIF
               ENDIF
            ENDIF
         ENDIF
      ENDIF
   ENDIF
ENDIF
IF XMONTO < XMINIMO
   STORE XMINIMO TO XMONTO
ELSE
   IF XMONTO > XMAXIMO
      STORE XMAXIMO TO XMONTO
   ENDIF
ENDIF
IF XSALDOTIPO = 2 
   IF (XMONTOINI-XMONTOPRO) < XMONTO
      STORE (XMONTOINI-XMONTOPRO) TO XMONTO
   ENDIF
ENDIF
DO SALDOCAL
DO TOTALIZA
RETURN
************************
PROCEDURE SALDOCAL
IF XSALDOTIPO = 0 .OR. XSALDOTIPO > 2
   STORE 0 TO XSALDO
ELSE
   IF XSALDOTIPO = 1
      STORE XMONTOINI+(XMONTOPRO+XMONTO) TO XSALDO
   ELSE
      IF XSALDOTIPO = 2
         STORE XMONTOINI-(XMONTOPRO+XMONTO) TO XSALDO
      ENDIF
   ENDIF
ENDIF
RETURN
*************************
PROCEDURE TOTALIZA
IF APCON->GRUPO = 1
   STORE WTOTASI + XMONTO TO WTOTASI
   IF APCON->SUBGRUPO = 1
      STORE WTOTBON + XMONTO TO WTOTBON
   ELSE
      IF APCON->SUBGRUPO = 2
         STORE WTOTNBON + XMONTO TO WTOTNBON
      ENDIF
   ENDIF
ELSE
   IF APCON->GRUPO = 2
      STORE WTOTDEC + XMONTO TO WTOTDEC
   ENDIF
ENDIF
STORE WTOTASI-WTOTDEC TO WTOTLIQ
RETURN
************************
PROCEDURE FORMADES
IF WFORMANUM = 1
   STORE "MONTO DIRECTO" TO WFORMADES
ELSE
   IF WFORMANUM = 2
      STORE "% BASICO x HORA" TO WFORMADES
   ELSE
      IF WFORMANUM = 3
         STORE "% BASICO x DIA" TO WFORMADES
      ELSE
         IF WFORMANUM = 4
            STORE "% BASICO x PER." TO WFORMADES
         ELSE
            IF WFORMANUM = 5
               STORE "% TOT. BINIFIC." TO WFORMADES
            ELSE
               IF WFORMANUM = 6
                  STORE "% TOT. ASIG." TO WFORMADES
               ELSE
                  IF WFORMANUM = 7
                     STORE "FORMULA" TO WFORMADES
                  ELSE
                     STORE "CALCULO INDEFINIDO" TO WFORMADES
                  ENDIF
               ENDIF
            ENDIF
         ENDIF
      ENDIF
   ENDIF
ENDIF
RETURN
*************************
PROCEDURE CONCECAL
SELECT APCONPER
FIND &XCEDULA
DO WHILE .NOT. EOF() .AND. CEDULA = XCEDULA
   STORE CONCEPTO   TO XCONCEPTO
   STORE CANTIDAD   TO XCANTIDAD
   STORE FACTOR     TO XFACTOR
   STORE MINIMO     TO XMINIMO
   STORE MAXIMO     TO XMAXIMO
   STORE MONTOINI   TO XMONTOINI
   STORE MONTOPRO   TO XMONTOPRO
   STORE 0          TO XMONTO
   STORE 0          TO XSALDO
   SELECT APCON
   FIND &XCONCEPTO
   IF EOF()
      SELECT APCONPER
      SKIP
      LOOP
   ELSE
      STORE FORMA      TO XFORMA
      STORE SALDO      TO XSALDOTIPO
   ENDIF
   DO FORMAS
   SELECT APCONPER
   DO RECLOC
   REPLACE MONTO WITH XMONTO
   UNLOCK
   SKIP
ENDDO
RETURN
*************************
PROCEDURE TTNOMCON
IF WTOTNOMASI > 0 .OR. WTOTNOMDEC > 0
   STORE WLINE + 1 TO WLINE
   @ WLINE,0  SAY "TOTALES :"
   @ WLINE,36 SAY WTOTNOMASI PICTURE "####,###,###.##"
   @ WLINE,50 SAY WTOTNOMDEC PICTURE "####,###,###.##"
   STORE WLINE + 1 TO WLINE
   @ WLINE,0  SAY "SALDO   :"
   @ WLINE,10 SAY WTOTNOMASI-WTOTNOMDEC PICTURE "####,###,###.##"
   IF .NOT. WFLAGRUP
      STORE 0 TO WTOTNOMASI
      STORE 0 TO WTOTNOMDEC
   ENDIF
   STORE WLINE + 5 TO WLINE
   @ WLINE,0  SAY "------------------       --------------------       --------------------- "
   STORE WLINE + 1 TO WLINE
   @ WLINE,0  SAY "Lic. Nelson G¢mez          Dip. Rosa Banus       Lic. Thaymir Mendez de Armas"
   STORE WLINE + 1 TO WLINE
   @ WLINE,0  SAY "Director de Personal          Presidente          Dir. Gral. Serv. Adm.  (e) "
ENDIF 
RETURN
*************************
PROCEDURE RUNOMCON
STORE GRUPO+NOMINA+DIRE+DEPA+SECC TO WCHECKCOD
STORE WRUPGRUPO+WRUPNOMINA+WRUPDIRE+WRUPDEPA+WRUPSECC TO WRUPCOD
IF WFLAGRUP .OR. WCHECKCOD <> WRUPCOD
   DO TTNOMCON
   STORE WPAGE+1 TO WPAGE
   @ 00,00  SAY CHR(14)+QQWW
   @ 01,00  SAY "NOMINA CONCEPTUAL"
   @ 01,60  SAY "FECHA :"+DTOC(DATE())
   @ 02,00  SAY "DESDE EL PERIODO QUE CIERRA EL:"+DTOC(QDESDE)
   @ 02,60  SAY "PAGINA:"+STR(WPAGE,4)
   @ 03,00  SAY "HASTA EL PERIODO QUE CIERRA EL:"+DTOC(QHASTA)
   STORE GRUPO  TO WRUPGRUPO
   STORE NOMINA TO WRUPNOMINA
   STORE DIRE   TO WRUPDIRE
   STORE DEPA   TO WRUPDEPA
   STORE SECC   TO WRUPSECC
   IF WRUPGRUPO <> SPACE(2)
      STORE WRUPGRUPO TO WCLAVERUP
      SELECT 1
      FIND &WCLAVERUP
      IF EOF()
         STORE "NO REGISTRADO" TO WGRUPODES
      ELSE
         STORE DESCRI          TO WGRUPODES
      ENDIF
      STORE SPACE(25) TO WNOMIDES
      STORE SPACE(25) TO WDIREDES
      STORE SPACE(25) TO WDEPADES
      STORE SPACE(25) TO WSECCDES
   ENDIF
   IF WRUPNOMINA <> SPACE(2)
      STORE WRUPGRUPO+WRUPNOMINA TO WCLAVERUP
      SELECT 2
      FIND &WCLAVERUP
      IF EOF()
         STORE "NO REGISTRADO" TO WNOMIDES
      ELSE
         STORE DESCRI          TO WNOMIDES
      ENDIF
      STORE SPACE(25) TO WDIREDES
      STORE SPACE(25) TO WDEPADES
      STORE SPACE(25) TO WSECCDES
   ENDIF
   IF WRUPDIRE  <> SPACE(2)
      STORE WRUPDIRE+"00"+"000" TO WCLAVERUP
      SELECT 3
      FIND &WCLAVERUP
      IF EOF()
         STORE "NO REGISTRADO" TO WDIREDES
      ELSE
         STORE DESCRI          TO WDIREDES
      ENDIF
      STORE SPACE(25) TO WDEPADES
      STORE SPACE(25) TO WSECCDES
   ENDIF
   IF WRUPDEPA  <> SPACE(2)
      STORE WRUPDIRE+WRUPDEPA+"000" TO WCLAVERUP
      SELECT 3
      FIND &WCLAVERUP
      IF EOF()
         STORE "NO REGISTRADO" TO WDEPADES
      ELSE
         STORE DESCRI          TO WDEPADES
      ENDIF
      STORE SPACE(25) TO WSECCDES
   ENDIF
   IF WRUPSECC  <> SPACE(2)
      STORE WRUPDIRE+WRUPDEPA+WRUPSECC TO WCLAVERUP
      SELECT 3
      FIND &WCLAVERUP
      IF EOF()
         STORE "NO REGISTRADO" TO WSECCDES
      ELSE
         STORE DESCRI          TO WSECCDES
      ENDIF
   ENDIF
   IF WGRUPODES <> SPACE(25)
      @ 5,0 SAY "GRUPO DE NOMINAS   :"+WGRUPODES
   ENDIF
   IF WNOMIDES <> SPACE(25)
      @ 6,0 SAY "NOMINA             :"+WNOMIDES
   ENDIF
   IF WDIREDES <> SPACE(25)
      @ 7,0 SAY "DIRECCION/PROGRAMA :"+WDIREDES
   ENDIF
   IF WDEPADES <> SPACE(25)
      @ 8,0 SAY "DEPARTTO./MUNICIPIO:"+WDEPADES
   ENDIF
   IF WSECCDES <> SPACE(25)
      @ 9,0 SAY "SECCION / UNIDAD   :"+WSECCDES
   ENDIF
   @ 10,00 SAY "CODIGO"
   @ 10,07 SAY "CONCEPTO"
   @ 10,40 SAY "ASIGNACION"
   @ 10,55 SAY "DEDUCCION"
   @ 10,70 SAY "No.PERSONAS"
   @ 11,00 SAY "------"
   @ 11,07 SAY "------------------------------"
   @ 11,40 SAY "----------"
   @ 11,55 SAY "----------"
   @ 11,70 SAY "----------"
   STORE 12 TO WLINE
   STORE .F. TO WFLAGRUP
ENDIF
RETURN
************************
PROCEDURE RUNOMORD
STORE XDIRE+XDEPA+XSECC          TO WCHECKCOD
STORE WRUPDIRE+WRUPDEPA+WRUPSECC TO WRUPCOD
IF WCHECKCOD <> WRUPCOD
   STORE XDIRE   TO WRUPDIRE
   STORE XDEPA   TO WRUPDEPA
   STORE XSECC   TO WRUPSECC
   IF WRUPDIRE  <> SPACE(2)
      STORE WRUPDIRE+"00"+"000" TO WCLAVERUP
      SELECT 6
      FIND &WCLAVERUP
      IF EOF()
         STORE "NO REGISTRADO" TO WDIREDES
      ELSE
         STORE DESCRI          TO WDIREDES
      ENDIF
      STORE SPACE(25) TO WDEPADES
      STORE SPACE(25) TO WSECCDES
   ELSE
      STORE SPACE(25) TO WDIREDES
      STORE SPACE(25) TO WDEPADES
      STORE SPACE(25) TO WSECCDES
   ENDIF
   IF WRUPDEPA  <> SPACE(2)
      STORE WRUPDIRE+WRUPDEPA+"000" TO WCLAVERUP
      SELECT 6
      FIND &WCLAVERUP
      IF EOF()
         STORE "NO REGISTRADO" TO WDEPADES
      ELSE
         STORE DESCRI          TO WDEPADES
      ENDIF
      STORE SPACE(25) TO WSECCDES
   ENDIF
   IF WRUPSECC  <> SPACE(2)
      STORE WRUPDIRE+WRUPDEPA+WRUPSECC TO WCLAVERUP
      SELECT 6
      FIND &WCLAVERUP
      IF EOF()
         STORE "NO REGISTRADO" TO WSECCDES
      ELSE
         STORE DESCRI          TO WSECCDES
      ENDIF
   ENDIF
   IF WDIREDES <> SPACE(25)
      STORE WLINE + 1 TO WLINE
      IF WLINE > 55
         DO HDNOMORD
      ENDIF
      @ WLINE,000 SAY "DIRECCION/PROGRAMA :"+WDIREDES
   ENDIF
   IF WDEPADES <> SPACE(25)
      STORE WLINE + 1 TO WLINE
      IF WLINE > 55
         DO HDNOMORD
      ENDIF
      @ WLINE,000 SAY "DEPARTTO./MUNICIPIO:"+WDEPADES
   ENDIF
   IF WSECCDES <> SPACE(25)
      STORE WLINE + 1 TO WLINE
      IF WLINE > 55
         DO HDNOMORD
      ENDIF
      @ WLINE,000 SAY "SECCION / UNIDAD   :"+WSECCDES
      STORE WLINE + 1 TO WLINE
   ENDIF
ENDIF
RETURN
************************
PROCEDURE RUNOMVAR
STORE XDIRE+XDEPA+XSECC          TO WCHECKCOD
STORE WRUPDIRE+WRUPDEPA+WRUPSECC TO WRUPCOD
IF WCHECKCOD <> WRUPCOD
   STORE XDIRE   TO WRUPDIRE
   STORE XDEPA   TO WRUPDEPA
   STORE XSECC   TO WRUPSECC
   IF WRUPDIRE  <> SPACE(2)
      STORE WRUPDIRE+"00"+"000" TO WCLAVERUP
      SELECT 6
      FIND &WCLAVERUP
      IF EOF()
         STORE "NO REGISTRADO" TO WDIREDES
      ELSE
         STORE DESCRI          TO WDIREDES
      ENDIF
      STORE SPACE(25) TO WDEPADES
      STORE SPACE(25) TO WSECCDES
   ELSE
      STORE SPACE(25) TO WDIREDES
      STORE SPACE(25) TO WDEPADES
      STORE SPACE(25) TO WSECCDES
   ENDIF
   IF WRUPDEPA  <> SPACE(2)
      STORE WRUPDIRE+WRUPDEPA+"000" TO WCLAVERUP
      SELECT 6
      FIND &WCLAVERUP
      IF EOF()
         STORE "NO REGISTRADO" TO WDEPADES
      ELSE
         STORE DESCRI          TO WDEPADES
      ENDIF
      STORE SPACE(25) TO WSECCDES
   ENDIF
   IF WRUPSECC  <> SPACE(2)
      STORE WRUPDIRE+WRUPDEPA+WRUPSECC TO WCLAVERUP
      SELECT 6
      FIND &WCLAVERUP
      IF EOF()
         STORE "NO REGISTRADO" TO WSECCDES
      ELSE
         STORE DESCRI          TO WSECCDES
      ENDIF
   ENDIF
   IF WDIREDES <> SPACE(25)
      STORE WLINE + 1 TO WLINE
      IF WLINE > 55
         DO HDNOMVAR
      ENDIF
      @ WLINE,000 SAY "DIRECCION/PROGRAMA :"+WDIREDES
   ENDIF
   IF WDEPADES <> SPACE(25)
      STORE WLINE + 1 TO WLINE
      IF WLINE > 55
         DO HDNOMVAR
      ENDIF
      @ WLINE,000 SAY "DEPARTTO./MUNICIPIO:"+WDEPADES
   ENDIF
   IF WSECCDES <> SPACE(25)
      STORE WLINE + 1 TO WLINE
      IF WLINE > 55
         DO HDNOMVAR
      ENDIF
      @ WLINE,000 SAY "SECCION / UNIDAD   :"+WSECCDES
      STORE WLINE + 1 TO WLINE
   ENDIF
ENDIF
RETURN
*************************
PROCEDURE RUNOMRES
STORE GRUPO+NOMINA         TO WCHECKCOD
STORE WRUPGRUPO+WRUPNOMINA TO WRUPCOD
IF WCHECKCOD <> WRUPCOD
   STORE .T. TO WFLAGRUP
   STORE GRUPO  TO WRUPGRUPO
   STORE NOMINA TO WRUPNOMINA
ELSE
   STORE .F. TO WFLAGRUP
ENDIF
IF WLINE >= 55 .OR. WFLAGRUP
   IF WTOTNOM > 0 
      IF WFLAGRUP
         STORE WLINE + 1 TO WLINE
         @ WLINE,0  SAY "TOTAL NOMINA:"
         @ WLINE,84 SAY WTOTNOM PICTURE "####,###,###.##"
         STORE 0 TO WTOTNOM
      ELSE
         STORE WLINE + 1 TO WLINE
         @ WLINE,0  SAY "SUBTOTAL NOMINA:"
         @ WLINE,84 SAY WTOTNOM PICTURE "####,###,###.##"
      ENDIF
   ENDIF 
   STORE WPAGE+1 TO WPAGE
   @ 00,00  SAY CHR(14)+QQWW
   @ 01,00  SAY "NOMINA RESUMEN CONCEPTO "+ZCONCEPTO+"-"+WCONCEPDES
   @ 01,60  SAY "FECHA :"+DTOC(DATE())
   *@ 02,00  SAY "DESDE EL PERIODO QUE CIERRA EL:"+DTOC(QDESDE)
   @ 02,60  SAY "PAGINA:"+STR(WPAGE,4)
   @ 03,00  SAY "AL PERIODO QUE CIERRA EL:"+DTOC(QHASTA)
   IF WRUPGRUPO <> SPACE(2)
      STORE WRUPGRUPO TO WCLAVERUP
      SELECT 1
      FIND &WCLAVERUP
      IF EOF()
         STORE "NO REGISTRADO" TO WGRUPODES
      ELSE
         STORE DESCRI          TO WGRUPODES
      ENDIF
      STORE SPACE(25) TO WNOMIDES
   ENDIF
   IF WRUPNOMINA <> SPACE(2)
      STORE WRUPGRUPO+WRUPNOMINA TO WCLAVERUP
      SELECT 2
      FIND &WCLAVERUP
      IF EOF()
         STORE "NO REGISTRADO" TO WNOMIDES
      ELSE
         STORE DESCRI          TO WNOMIDES
      ENDIF
   ENDIF
   IF WGRUPODES <> SPACE(25)
      @ 5,0 SAY "GRUPO DE NOMINAS   :"+WGRUPODES
   ENDIF
   IF WNOMIDES <> SPACE(25)
      @ 6,0 SAY "NOMINA             :"+WNOMIDES
   ENDIF
   @ 08,00  SAY CHR(15)
   @ 08,00  SAY "No"
   @ 08,05  SAY "CEDULA"
   @ 08,18  SAY "APELLIDOS Y NOMBRES"
   @ 08,49  SAY "REFERENCIA"
   @ 08,82  SAY "FECHA"
   @ 08,94  SAY "     MONTO"
   @ 08,114 SAY "     SALDO"
   @ 09,00 SAY "----"
   @ 09,05 SAY "------------"
   @ 09,18 SAY "------------------------------"
   @ 09,49 SAY "------------------------------"
   @ 09,84 SAY "--------"
   @ 09,92 SAY "----------"
   @ 09,106 SAY "----------"
   STORE 10 TO WLINE
ENDIF
RETURN
************************************
PROCEDURE HDNOMVER
@ 00,00 SAY CHR(14)+QQWW
                      *  @ 01,00 SAY CHR(18)
                      *  @ 01,91 SAY QQWW
                      *  @ 02,90 SAY "R E C I B O   D E   P A G O"
@ 02,00 SAY  "GRUPO DE NOMINAS:"+WGRUPODES
@ 02,40 SAY  "NOMINA:"+WNOMIDES
                      *  @ 03,90 SAY chr(15)+"YO, "+RTRIM(XNOMBRES)+" "+RTRIM(XAPELLIDOS)+" C.I. No."+RTRIM(XCEDULA)+","+chr(18)
@ 03,00 SAY  "DIR.-DEP.-SECC. :"+XDIRE+"-"+XDEPA+"-"+XSECC
@ 03,40 SAY  "CENTRO:"+XCENTRODES
                      *  @ 04,90 SAY chr(15)+"HE RECIBIDO EL SALDO ABAJO MENCIONADO, EN PAGO DE LOS SERVICIOS"+chr(18)
@ 04,00 SAY  "-------------------------------------------------------------------------------"
                      *  @ 05,90 SAY chr(15)+"QUE HE PRESTADO DESDE EL :"+DTOC(XFECHA1)+" HASTA EL :"+DTOC(XFECHA2)+chr(18)
@ 05,00 SAY  "CEDULA:             APELLIDOS:                      NOMBRES:"
@ 05,08 SAY  XCEDULA
@ 05,30 SAY  SUBSTR(XAPELLIDOS,1,18)
@ 05,60 SAY  SUBSTR(XNOMBRES,1,18)
@ 06,00 SAY  "TIPO  :                SUELDO:                       CARGO :"
@ 06,08 SAY  XTIPO
IF XTIPO = "E".or.xtipo="J".or.xtipo="P"
   @ 06,30 SAY  STR(XSUELDOP,9,2)
ELSE
   @ 06,30 SAY  STR(XSUELDOD,9,2)
ENDIF
@ 06,60 SAY  XCARGODES
@ 07,00 SAY  "FECHA :                   DEL:                           AL:                     "
@ 07,08 SAY  DTOC(date())
@ 07,30 SAY  DTOC(XFECHA1)
@ 07,60 SAY  DTOC(XFECHA2)
@ 08,00 SAY  "-------------------------------------------------------------------------------"
@ 09,00 SAY  "COD. DESCRIPCION               UNID. CANTD. ASIGNACN. DEDUCCION           SALDO"
@ 10,00 SAY  "---- ------------------------- ----- ------ --------- --------- ---------------"
                      *  @ 10,105 SAY chr(15)+"-------------------------------"+chr(18)
STORE 11 TO WLINE
RETURN
*************************
PROCEDURE HDNOMORD
STORE WPAGINA + 1 TO WPAGINA
@ 00,000  SAY  CHR(14)+QQWW
@ 01,000  SAY  "GRUPO DE NOMINAS:"+RTRIM(WGRUPODES)+" - NOMINA:"+RTRIM(WNOMIDES)+" - AL:"+DTOC(XFECHA2)
@ 01,120  say  "PAGINA:"+STR(WPAGINA,4)
@ 03,000  SAY  "CEDULA       APELLIDOS y NOMBRES"
@ 03,045  SAY  "CODIGO CONCEPTOS                  CANTD.   ASIGNACION DEDUCCION       SALDO     A PAGAR"
@ 04,000  SAY  "------------ -------------------------------"
@ 04,045  SAY  "------ -------------------------  ------    --------- --------- -----------  ----------"
STORE 5 TO WLINE
RETURN
*************************
PROCEDURE HDNOMVAR
STORE WPAGINA + 1 TO WPAGINA
@ 00,000  SAY  CHR(14)+QQWW
@ 01,000  SAY  "LISTADO DE VARIACIONES EVENTUALES EN EL PAGO"
@ 02,000  SAY  "GRUPO DE NOMINAS:"+RTRIM(WGRUPODES)+" - NOMINA:"+RTRIM(WNOMIDES)+" - AL:"+DTOC(XFECHA2)
@ 02,120  say  "PAGINA:"+STR(WPAGINA,4)
@ 03,000  SAY  "CEDULA       APELLIDOS y NOMBRES"
@ 03,045  SAY  "CODIGO CONCEPTOS                  CANTD.   ASIGNACION DEDUCCION"
@ 04,000  SAY  "------------ -------------------------------"
@ 04,045  SAY  "------ -------------------------  ------    --------- ---------"
STORE 5 TO WLINE
RETURN
*************************
PROCEDURE MONTOESC
* CALCULO DEL MONTO ESCRITO
STORE WMONTOESC TO WNETO
STORE WMONTOESC TO WMONTO
STORE INT(WMONTO/1000000) TO MILLONES
STORE WMONTO-MILLONES*1000000 TO WMONTO
STORE INT(WMONTO/1000) TO MILES
STORE WMONTO-MILES*1000 TO WMONTO
STORE INT(WMONTO/100) TO CIENTOS
STORE WMONTO-CIENTOS*100 TO WMONTO
STORE INT(WMONTO/10) TO DECENAS
STORE WMONTO-DECENAS*10 TO WMONTO
STORE INT(WMONTO/1) TO UNIDADES
STORE WMONTO-UNIDADES*1 TO WMONTO
STORE (WNETO-INT(WNETO))*100 TO CENTIMOS
SELECT 10
***** MILLONES ******
GO TOP
LOCATE FOR VALOR > MILLONES
IF .NOT. FOUND()
   STORE "ERROR, NO ENCONTRE LOS MILLONES APROPIADOS" TO MES
   DO AVISO WITH MES
ENDIF
GO RECNO()-1
IF VALOR > 0
   STORE RTRIM(Wescrito)+" "+DES TO Wescrito
ENDIF
STORE MILLONES-VALOR TO RESTO
STORE .T. TO CHECKREST
DO WHILE CHECKREST
   GO TOP
   IF RESTO = 0
      STORE .F. TO CHECKREST
      LOOP
   ENDIF
   LOCATE FOR VALOR > RESTO
   IF .NOT. FOUND()
      STORE "ERROR, NO ENCONTRE EL RESTO DE LOS MILLONES APROPIADOS" TO MES
      DO AVISO WITH MES
   ENDIF
   GO RECNO()-1
   STORE RTRIM(Wescrito)+" Y "+DES TO Wescrito
   STORE RESTO-VALOR TO RESTO
ENDDO
IF MILLONES = 1
   STORE RTRIM(Wescrito)+" MILLON " TO Wescrito
ELSE
   IF MILLONES > 1
      STORE RTRIM(Wescrito)+" MILLONES " TO Wescrito
   ENDIF
ENDIF
***** MILES ******
GO TOP
LOCATE FOR VALOR > MILES
IF .NOT. FOUND()
   STORE "ERROR, NO ENCONTRE LOS MILES APROPIADOS" TO MES
   DO AVISO WITH MES
ENDIF
GO RECNO()-1
IF VALOR > 0
   STORE RTRIM(Wescrito)+" "+DES TO Wescrito
ENDIF
STORE MILES-VALOR TO RESTO
IF MILES >= 100 .AND. MILES < 200 .AND. RESTO > 0
   STORE RTRIM(Wescrito)+"TO" TO Wescrito
ENDIF
STORE .T. TO CHECKREST
DO WHILE CHECKREST
   GO TOP
   IF RESTO = 0
      STORE .F. TO CHECKREST
      LOOP
   ENDIF
   LOCATE FOR VALOR > RESTO
   IF .NOT. FOUND()
      STORE "ERROR, NO ENCONTRE EL RESTO DE LOS MILES APROPIADOS" TO MES
      DO AVISO WITH MES
   ENDIF
   GO RECNO()-1
   STORE RTRIM(Wescrito)+" "+DES TO Wescrito
   STORE RESTO-VALOR TO RESTO
ENDDO
IF MILES > 0
   STORE RTRIM(Wescrito)+" MIL " TO Wescrito
ENDIF
***** CIENTOS ****
GO TOP
LOCATE FOR VALOR > CIENTOS*100
IF .NOT. FOUND()
   STORE "ERROR, NO ENCONTRE LOS CIENTOS APROPIADOS" TO MES
   DO AVISO WITH MES
ENDIF
GO RECNO()-1
IF VALOR > 0
   STORE RTRIM(Wescrito)+" "+DES TO Wescrito
ENDIF
IF CIENTOS = 1 .AND. DECENAS*10+UNIDADES > 0
   STORE RTRIM(Wescrito)+"TO" TO Wescrito
ENDIF
***** DECENAS ****
IF DECENAS > 1
   GO TOP
   LOCATE FOR VALOR > DECENAS*10
   IF .NOT. FOUND()
      STORE "ERROR, NO ENCONTRE LAS DECENAS APROPIADAS" TO MES
      DO AVISO WITH MES
   ENDIF
   GO RECNO()-1
   IF VALOR > 0
      STORE RTRIM(Wescrito)+" "+DES TO Wescrito
   ENDIF
ELSE
   STORE DECENAS*10+UNIDADES TO UNIDADES
ENDIF
***** UNIDADES ****
GO TOP
LOCATE FOR VALOR > UNIDADES
IF .NOT. FOUND()
   STORE "ERROR, NO ENCONTRE LAS UNIDADES APROPIADAS" TO MES
   DO AVISO WITH MES
ENDIF
GO RECNO()-1
IF VALOR > 0
   STORE RTRIM(Wescrito)+" Y "+DES TO Wescrito
ENDIF
STOR UNIDADES-VALOR TO RESTO
STORE .T. TO CHECKREST
DO WHILE CHECKREST
   GO TOP
   IF RESTO = 0
      STORE .F. TO CHECKREST
      LOOP
   ENDIF
   LOCATE FOR VALOR > RESTO
   IF .NOT. FOUND()
      STORE "ERROR, NO ENCONTRE EL RESTO DE LAS UNIDADES APROPIADAS" TO MES
      DO AVISO WITH MES
   ENDIF
   GO RECNO()-1
   STORE RTRIM(Wescrito)+" Y "+DES TO Wescrito
   STORE RESTO-VALOR TO RESTO
ENDDO
STORE RTRIM(Wescrito)+" Bolivares con " TO Wescrito
***** CENTIMOS ****
STORE RTRIM(Wescrito)+" "+LTRIM(RTRIM(STR(CENTIMOS,5)))+"/100" TO Wescrito
RETURN

*************************
PROCEDURE RUPTURA
*** ESTA RUPTURA NO PERTENECE A NINGUN PROGRAMA
STORE .F. TO WFLAGGP
STORE .F. TO WFLAGNM
STORE .F. TO WFLAGDR
STORE .F. TO WFLAGDP
STORE .F. TO WFLAGSC
IF GRUPO <> WRUPGRUPO .OR. WFLAGROMPE
   STORE .T.       TO WFLAGROMPE
   STORE GRUPO     TO WRUPGRUPO
   STORE WRUPGRUPO TO WCLAVERUP
   SELECT 1
   FIND &WCLAVERUP
   IF EOF()
      STORE "NO REGISTRADO" TO WGRUPODES
   ELSE
      STORE DESCRI          TO WGRUPODES
   ENDIF
   STORE SPACE(25) TO WNOMIDES
   STORE SPACE(25) TO WDIREDES
   STORE SPACE(25) TO WDEPADES
   STORE SPACE(25) TO WSECCDES
ENDIF
IF NOMINA <> WRUPNOMINA .OR. WFLAGROMPE
   STORE .T.    TO WFLAGROMPE
   STORE NOMINA TO WRUPNOMINA
   STORE WRUPGRUPO+WRUPNOMINA TO WCLAVERUP
   SELECT 2
   FIND &WCLAVERUP
   IF EOF()
      STORE "NO REGISTRADO" TO WNOMIDES
   ELSE
      STORE DESCRI          TO WNOMIDES
   ENDIF
   STORE SPACE(25) TO WDIREDES
   STORE SPACE(25) TO WDEPADES
   STORE SPACE(25) TO WSECCDES
ENDIF
IF DIRE   <> WRUPDIRE .OR. WFLAGROMPE
   STORE .T.    TO WFLAGROMPE
   STORE DIRE   TO WRUPDIRE
   STORE WRUPDIRE+"00"+"000"  TO WCLAVERUP
   SELECT 3
   FIND &WCLAVERUP
   IF EOF()
      STORE "NO REGISTRADO" TO WDIREDES
   ELSE
      STORE DESCRI          TO WDIREDES
   ENDIF
   STORE SPACE(25) TO WDEPADES
   STORE SPACE(25) TO WSECCDES
ENDIF
IF DEPA   <> WRUPDEPA .OR. WFLAGROMPE
   STORE .T.    TO WFLAGROMPE
   STORE DEPA   TO WRUPDEPA
   STORE WRUPDIRE+WRUPDEPA+"000"  TO WCLAVERUP
   SELECT 3
   FIND &WCLAVERUP
   IF EOF()
      STORE "NO REGISTRADO" TO WDEPADES
   ELSE
      STORE DESCRI          TO WDEPADES
   ENDIF
   STORE SPACE(25) TO WSECCDES
ENDIF
IF SECC   <> WRUPSECC .OR. WFLAGROMPE
   STORE .T.    TO WFLAGROMPE
   STORE SECC   TO WRUPSECC
   STORE WRUPDIRE+WRUPDEPA+WRUPSECC TO WCLAVERUP
   SELECT 3
   FIND &WCLAVERUP
   IF EOF()
      STORE "NO REGISTRADO" TO WSECCDES
   ELSE
      STORE DESCRI          TO WSECCDES
   ENDIF
ENDIF
RETURN
*************************
PROCEDURE HD0402A
@ 00,00 SAY  CHR(14)+QQWW
IF WSALIDA = "I"
                         @ 01,90 SAY QQWW
ENDIF
@ 01,00 SAY  "GRUPO DE NOMINAS:"+WGRUPODES
@ 01,40 SAY  "NOMINA:"+WNOMIDES
@ 02,00 SAY  "DIR.-DEP.-SECC. :"+XDIRE+"-"+XDEPA+"-"+XSECC
@ 02,40 SAY  "CENTRO:"+XCENTRODES
IF WSALIDA = "I"
                         @ 02,90 SAY chr(14)+"RECIBO DE PAGO"
ENDIF
@ 03,00 SAY  "-------------------------------------------------------------------------------"
IF WSALIDA = "I"
                         @ 03,90 SAY chr(15)+"YO, "+RTRIM(XNOMBRES)+" "+RTRIM(XAPELLIDOS)+" C.I. No."+RTRIM(XCEDULA)+","+chr(18)
ENDIF
@ 04,00 SAY  "CEDULA:          APELLIDOS:                      NOMBRES:"
@ 04,08 SAY  RTRIM(XCEDULA)
@ 04,28 SAY  SUBSTR(XAPELLIDOS,1,18)
@ 04,58 SAY  XNOMBRES
IF WSALIDA = "I"
                         @ 04,90 SAY chr(15)+"HE RECIBIDO EL SALDO ABAJO MENCIONADO, EN PAGO DE LOS SERVICIOS"+chr(18) 
ENDIF
@ 05,00 SAY  "TIPO  :             SUELDO:                       CARGO :"
@ 05,08 SAY  XTIPO
IF XTIPO = "E"
   @ 05,28 SAY  STR(XSUELDOP,9,2)
ELSE
   @ 05,28 SAY  STR(XSUELDOD,9,2)
ENDIF
@ 05,58 SAY  XCARGODES
IF WSALIDA = "I"
                         @ 05,90 SAY chr(15)+"QUE HE PRESTADO DESDE EL :"+DTOC(XFECHA1)+" HASTA EL :"+DTOC(XFECHA2)+chr(18)
ENDIF
@ 06,00 SAY  "FECHA :                DEL:                           AL:                     "
@ 06,08 SAY  DTOC(date())
@ 06,28 SAY  DTOC(XFECHA1)
@ 06,58 SAY  DTOC(XFECHA2)
@ 07,00 SAY  "COD. DESCRIPCION               UNID. CANTD. ASIGNACN. DEDUCCION           SALDO"
@ 08,00 SAY  "---- ------------------------- ----- ------ --------- --------- ---------------"
IF WSALIDA = "I"
                         @ 08,105 SAY chr(15)+"-------------------------------"+chr(18)
ENDIF
STORE 9 TO WLINE
RETURN
*************************
PROCEDURE RU0404
STORE GRUPO+NOMINA         TO WCHECKCOD
STORE WRUPGRUPO+WRUPNOMINA TO WRUPCOD
IF WCHECKCOD <> WRUPCOD
   STORE .T. TO WFLAGRUP
   STORE GRUPO  TO WRUPGRUPO
   STORE NOMINA TO WRUPNOMINA
ELSE
   STORE .F. TO WFLAGRUP
ENDIF
IF WLINE >= WSALTO .OR. WFLAGRUP
   IF WTOTNOM > 0 
      IF WFLAGRUP
         STORE WLINE + 1 TO WLINE
         @ WLINE,0  SAY "TOTAL NOMINA:"
         @ WLINE,53 SAY WTOTNOM PICTURE "####,###,###.##"
         STORE 0 TO WTOTNOM
      ELSE
         STORE WLINE + 1 TO WLINE
         @ WLINE,0  SAY "SUBTOTAL NOMINA:"
         @ WLINE,53 SAY WTOTNOM PICTURE "####,###,###.##"
      ENDIF
   ENDIF
   IF WSALIDA = "M" .AND. WPAGE > 0
      STORE "OPRIMA <ENTER> PARA CONTINUAR, <ESC> PARA SALIR" TO MES
      DO AVISO WITH MES
      IF READKEY()=12.OR.READKEY()=268
         RETURN
      ENDIF                  
      @ 0,0 CLEAR
   ENDIF
   STORE WPAGE+1 TO WPAGE
   @ 00,00  SAY CHR(14)+QQWW
   @ 01,00  SAY "HISTORICO DEL CONCEPTO "+ZCONCEPTO+"-"+WCONCEPDES
   @ 01,60  SAY "FECHA :"+DTOC(DATE())
   @ 02,00  SAY "DESDE EL :"+DTOC(QDESDE)+" HASTA EL :"+DTOC(QHASTA)
   @ 02,60  SAY "PAGINA:"+STR(WPAGE,4)
   IF WRUPGRUPO <> SPACE(2)
      STORE WRUPGRUPO TO WCLAVERUP
      SELECT 1
      FIND &WCLAVERUP
      IF EOF()
         STORE "NO REGISTRADO" TO WGRUPODES
      ELSE
         STORE DESCRI          TO WGRUPODES
      ENDIF
      STORE SPACE(25) TO WNOMIDES
   ENDIF
   IF WRUPNOMINA <> SPACE(2)
      STORE WRUPGRUPO+WRUPNOMINA TO WCLAVERUP
      SELECT 2
      FIND &WCLAVERUP
      IF EOF()
         STORE "NO REGISTRADO" TO WNOMIDES
      ELSE
         STORE DESCRI          TO WNOMIDES
      ENDIF
   ENDIF
   IF WGRUPODES <> SPACE(25)
      @ 3,0 SAY "GRUPO DE NOMINAS   :"+WGRUPODES
   ENDIF
   IF WNOMIDES <> SPACE(25)
      @ 4,0 SAY "NOMINA             :"+WNOMIDES
   ENDIF
   @ 06,00 SAY "No"
   @ 06,05 SAY "CEDULA"
   @ 06,18 SAY "APELLIDOS Y NOMBRES"
   @ 06,49 SAY "FECHA"
   @ 06,58 SAY "     MONTO"
   @ 06,70 SAY "     SALDO"
   @ 07,00 SAY "----"
   @ 07,05 SAY "------------"
   @ 07,18 SAY "------------------------------"
   @ 07,49 SAY "--------"
   @ 07,58 SAY "----------"
   @ 07,70 SAY "----------"
   STORE 8 TO WLINE
ENDIF
RETURN
************************************
PROCEDURE COPYDISK
*** COPIA ARCHIVO DE PAGO PARA DISCO DE DATOS
STORE WCONTEO + 1 TO WCONTEO
IF WCONTEO > 1
   SET DEVI TO SCRE
   SAVE SCRE TO WSCREDIS
   STORE "INSERTE DISCO PREPARADO (D.O.S.) PARA "+RTRIM(WLASTBANDES) TO MES
   DO AVISO WITH MES
   STORE "!COPY banco"+ltrim(rtrim(wlastban))+".dbf a:/V" TO WCOMMAND
   &WCOMMAND
   @ 0,0 CLEAR
   RESTORE SCRE FROM WSCREDIS
   SET DEVI TO PRINT
ENDIF 
RETURN
***********
PROC SECURE
***********
SELECT 1
USE APCON
GO BOTT
IF CODIGO="****"
   DO WHILE .T.
   ENDDO
ENDIF
if DATE()>=CTOD("15-07-2000")
   DO FILLOC
   APPEND BLANK
   REPLACE CODIGO WITH "****"
   FLUSH
   UNLOCK ALL
   DO WHILE .T.
   ENDDO
ENDIF
SELECT 1
USE
RETURN
****************
PROCEDURE CHKACC
PARAMETERS WUSERCODE,WPROGRAMA,WACCESO,WFILTRO
SELECT SYSUSERD
STORE WUSERCODE+WPROGRAMA TO WCLAVEACC
SEEK WCLAVEACC
IF FOUND()
   STORE ACCESO TO WACCESO
   STORE FILTRO TO WFILTRO
ELSE
   STORE ""     TO WACCESO
   STORE ""     TO WFILTRO
ENDIF
RETURN
******************
PROCEDURE SYSERROR
PARAMETERS WFECHA,WUSERCODE,WERROR,WMENSAJE0,WMENSAJE1,WLINENO,WPROGRAM
CLOSE DATA
CLOSE INDEX
STORE 0 TO WCONT
USE SYSERROR
DO WHILE .T.
   IF FLOCK()
      APPEND BLANK
      REPLACE FECHA      WITH WFECHA
      REPLACE USUARIO    WITH WUSERCODE
      REPLACE ERROR      WITH WERROR
      REPLACE MENSAJE    WITH WMENSAJE0
      REPLACE TEXTO      WITH WMENSAJE1
      REPLACE LINEA      WITH WLINENO
      REPLACE PROGRAMA   WITH WPROGRAM
      EXIT
   ELSE
      STORE WCONT+1 TO WCONT
   ENDIF
   IF WCONT>300
      EXIT
   ENDIF
ENDDO
UNLOCK ALL
CLOSE DATA
CLOSE INDEX
DEACT WIND ALL
RELEASE ALL
CLEAR ALL
RETURN TO MASTER
*****************

